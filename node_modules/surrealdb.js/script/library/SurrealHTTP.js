"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SurrealHTTP = void 0;
const errors_js_1 = require("../errors.js");
const processUrl_js_1 = require("./processUrl.js");
class SurrealHTTP {
    constructor(url, { fetcher, } = {}) {
        Object.defineProperty(this, "url", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        Object.defineProperty(this, "authorization", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        Object.defineProperty(this, "namespace", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        Object.defineProperty(this, "database", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        Object.defineProperty(this, "fetch", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        this.fetch = fetcher ?? fetch;
        this.url = (0, processUrl_js_1.processUrl)(url, {
            ws: "http",
            wss: "https",
        });
    }
    ready() {
        return !!(this.url && this.namespace && this.database);
    }
    setTokenAuth(token) {
        this.authorization = `Bearer ${token}`;
    }
    createRootAuth(username, password) {
        this.authorization = `Basic ${btoa(`${username}:${password}`)}`;
    }
    clearAuth() {
        this.authorization = undefined;
    }
    use(ns, db) {
        this.namespace = ns;
        this.database = db;
    }
    async request(path, options) {
        path = path.startsWith("/") ? path.slice(1) : path;
        if (!this.ready())
            throw new errors_js_1.NoConnectionDetails();
        return (await this.fetch(`${this.url}/${path}`, {
            method: options?.method ?? "POST",
            headers: {
                "Content-Type": options?.plainBody
                    ? "text/plain"
                    : "application/json",
                "Accept": "application/json",
                "NS": this.namespace,
                "DB": this.database,
                ...(this.authorization
                    ? { "Authorization": this.authorization }
                    : {}),
            },
            body: typeof options?.body == "string"
                ? options?.body
                : JSON.stringify(options?.body),
        })).json();
    }
}
exports.SurrealHTTP = SurrealHTTP;
//# sourceMappingURL=SurrealHTTP.js.map